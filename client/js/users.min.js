/*
 * Dynamic Suite: Users
 * License: GPLv3
 */
Vue.component("users-change-password",{template:'<div class="users change-password"><div v-if="!error.server" class="ds-container"><h3>Update Account Password</h3><aui-input type="password" label="Password" :failure="error.password" v-model="form.password_1"/><aui-input type="password" label="Confirm Password" :failure="error.password" v-model="form.password_2" /><aui-button @click="changePassword" :loading="state.calling" loading_text="Updating...">Update</aui-button></div></div>',data:()=>({state:{calling:!1},form:{password_1:null,password_2:null},error:{server:!1,password:null},page_data:{password_expired:!1}}),methods:{changePassword(){this.state.calling=!0,this.error.password=null;let s=new URLSearchParams(window.location.search.substr(1)).get("ref");null!==s&&""!==s||(s="/login"),DynamicSuite.call("users","change.password",this.form,a=>{switch(a.status){case"OK":window.location=s;break;case"BAD_PASSWORD":case"NO_CHANGE_REQUIRED":this.error.password=a.message,this.state.calling=!1;break;default:this.error.server=!0}})}}});
Vue.component("users-groups-crud",{template:'<div class="groups crud"><aui-crud v-bind="options"><template #list-title>Permission Groups</template><template #form="{ form, error, overlay }"><div class="col-2"><aui-input label="Name" :disabled="overlay" :failure="error.name" v-model="form.name" /><aui-input label="Description" :disabled="overlay" :failure="error.description" v-model="form.description" /></div><aui-select-assignment :assigned.sync="form.assigned_permissions" :unassigned.sync="form.unassigned_permissions" :disabled="overlay" /></template></aui-crud></div>',data:()=>({options:{package:"users",list_empty_text:"No groups found",list_api_read:"groups.list.read",form_api_read:"group.read",form_api_create_setup:"group.create.setup",form_api_create:"group.create",form_api_update:"group.update",form_api_delete:"group.delete",form_storable_key:"group_id",form_delete_text:"Are you sure you want to delete the group?",fields:["group_id","name","description","assigned_permissions","unassigned_permissions"],views:["form"]}})});
Vue.component("users-login",{template:'<div class="users login"><header v-if="application_header" v-html="application_header"/><div class="container"><div class="shadow"><header>{{form_header}}</header><form onsubmit="return false;"><aui-input id="username" placeholder="Username" leading_cap="<i class=\'fas fa-user\'></i>" :disable_autofill="false" :failure="error.form.username" v-model="form.username" /><aui-input placeholder="Password" type="password" leading_cap="<i class=\'fas fa-key\'></i>" :disable_autofill="false" :failure="error.form.password" v-model="form.password" /><aui-button :loading="state.calling" loading_text="Logging in..." @click="login">Login</aui-button><aui-alert type="failure" :visible="error.login" v-html="error.login" /><a v-if="register_href" :href="register_href">{{register_text}}</a><a v-if="help_href" :href="help_href">{{help_text}}</a></form></div><footer v-if="footer">{{footer}}</footer></div></div>',data:()=>({application_header:"Login Application Header",form_header:"Login Form Header",footer:"Â© My Application",register_href:null,register_text:"Register a new account",help_href:null,help_text:"I forgot my password",username_input:null,form:{username:null,password:null},state:{calling:!1},error:{server:!1,login:null,form:{username:null,password:null}}}),methods:{login(){this.error.login=null,this.error.form.username=null,this.error.form.password=null,this.state.calling=!0;let e=new URLSearchParams(window.location.search.substr(1)).get("ref");void 0!==e&&""!==e||(e=null),DynamicSuite.call("users","login",Object.assign({},this.form,{redirect:e}),e=>{switch(this.form.password=null,e.status){case"OK":window.location=e.data;break;case"CREDENTIAL":this.error.credential=!0,this.$set(this.error,"form",Object.assign(this.error.form,e.data)),this.state.calling=!1,this.username_input.focus(),this.username_input.select();break;case"LOGIN":this.error.login=e.message,this.state.calling=!1;break;default:this.error.server=!0}})}},mounted(){const e=DynamicSuite.getPageData();for(const r in e)e.hasOwnProperty(r)&&this.hasOwnProperty(r)&&(this[r]=e[r]);this.username_input=document.getElementById("username"),this.username_input.focus()}});
Vue.component("users-users-crud",{template:'<div class="users crud"><aui-crud v-bind="options"><template #list-title>Local Users</template><template #form="{ form, error, overlay }"><aui-input label="Username" :failure="error.username" :disabled="overlay" v-model="form.username" /><aui-checkbox :checked="form.inactive" :disabled="overlay" v-model="form.inactive">Inactive</aui-checkbox><h2>Password</h2><div class="col-2"><aui-input label="Password" type="password" :failure="error.password_1" :disabled="overlay" v-model="form.password_1" /><aui-input label="Confirm Password" type="password" :failure="error.password_2" :disabled="overlay" v-model="form.password_2" /></div><aui-checkbox :checked="form.password_expired" :disabled="overlay" v-model="form.password_expired">Force change password at next login</aui-checkbox><h2>Groups</h2><aui-select-assignment :assigned.sync="form.assigned_groups" :unassigned.sync="form.unassigned_groups" :disabled="overlay" /></template></aui-crud></div>',data:()=>({options:{package:"users",list_empty_text:"No users found",list_api_read:"users.list.read",form_api_read:"user.read",form_api_create_setup:"user.create.setup",form_api_create:"user.create",form_api_update:"user.update",form_api_delete:"user.delete",form_storable_key:"user_id",form_delete_text:"Are you sure you want to delete the user?",fields:["user_id","username","password_1","password_2","password_expired","root","inactive","inactive_by","inactive_on","login_last_attempt","login_last_success","login_last_ip","assigned_groups","unassigned_groups"],secure_fields:["password_1","password_2"],views:["form"]}})});
if(document.getElementById("users-component-view")){new Vue({el:"#users-component-view"});};